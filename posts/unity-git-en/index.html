<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Unity and Git - Northern Wind</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Chun-Fu Chao" /><meta name="description" content="This is the translated version of my 2020 Unity 和 git post with some minor updates and all the Chinese reference links removed. Sorry I am not a fluent English speaker. Please leave a comment if something seems wrong/out-dated. Thank you. I&amp;rsquo;ve been using Git to version control Unity projects for a while now. Recently, my company open-sourced our Unity builder mimiron-lite, along with a new set of Git configuration" />






<meta name="generator" content="Hugo 0.111.3 with theme even" />


<link rel="canonical" href="https://franknine.github.io/posts/unity-git-en/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.e1e2a0bc37cfb7c7c75cf44bf0dddb9731bfd371c71d7c30dc1e5b6932f4ef5e.css" rel="stylesheet">

<link rel="stylesheet" href="/css/twitter_center.css">


<meta property="og:title" content="Unity and Git" />
<meta property="og:description" content="This is the translated version of my 2020 Unity 和 git post with some minor updates and all the Chinese reference links removed. Sorry I am not a fluent English speaker. Please leave a comment if something seems wrong/out-dated. Thank you. I&rsquo;ve been using Git to version control Unity projects for a while now. Recently, my company open-sourced our Unity builder mimiron-lite, along with a new set of Git configuration" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://franknine.github.io/posts/unity-git-en/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-23T16:00:00+08:00" />
<meta property="article:modified_time" content="2023-04-23T16:00:00+08:00" />
<meta itemprop="name" content="Unity and Git">
<meta itemprop="description" content="This is the translated version of my 2020 Unity 和 git post with some minor updates and all the Chinese reference links removed. Sorry I am not a fluent English speaker. Please leave a comment if something seems wrong/out-dated. Thank you. I&rsquo;ve been using Git to version control Unity projects for a while now. Recently, my company open-sourced our Unity builder mimiron-lite, along with a new set of Git configuration"><meta itemprop="datePublished" content="2023-04-23T16:00:00+08:00" />
<meta itemprop="dateModified" content="2023-04-23T16:00:00+08:00" />
<meta itemprop="wordCount" content="6172">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Unity and Git"/>
<meta name="twitter:description" content="This is the translated version of my 2020 Unity 和 git post with some minor updates and all the Chinese reference links removed. Sorry I am not a fluent English speaker. Please leave a comment if something seems wrong/out-dated. Thank you. I&rsquo;ve been using Git to version control Unity projects for a while now. Recently, my company open-sourced our Unity builder mimiron-lite, along with a new set of Git configuration"/>




<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Northern Wind</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/cs291/">
        <li class="mobile-menu-item">CS291</li>
      </a><a href="https://github.com/FrankNine/franknine.github.io/wiki">
        <li class="mobile-menu-item">Wiki</li>
      </a><a href="/index.xml">
        <li class="mobile-menu-item">RSS</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Northern Wind</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/cs291/">CS291</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="https://github.com/FrankNine/franknine.github.io/wiki">Wiki</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/index.xml">RSS</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
  <div class="post-content">
    <p><em>This is the translated version of my 2020 <a href="unity-git/">Unity 和 git</a> post with some minor updates and all the Chinese reference links removed. Sorry I am not a fluent English speaker. Please leave a comment if something seems wrong/out-dated. Thank you.</em></p>
<p>I&rsquo;ve been using Git to version control Unity projects for a while now. Recently, my company open-sourced our Unity builder <a href="https://gitlab.com/rayark/mimiron-lite">mimiron-lite</a>, along with a new set of Git configuration files that are now being used as Git configuration standard of my company . I would like to share some insights regarding the thought process behind these configuration files and the experiences of using Git.</p>
<p>If you prefer a TL;DR, you can directly download the Git configuration files. The latest configuration now includes an updated <code>.gitignore</code> for Wwise, available at: <a href="https://github.com/FrankNine/RepoConfig">https://github.com/FrankNine/RepoConfig</a>.<br>
This repo was forked from: <a href="https://github.com/rayark/repo-config">https://github.com/rayark/repo-config</a>.<br>
The company has released this configuration under the <a href="https://tldrlegal.com/license/mit-license">MIT License</a>.</p>
<h1 id="gui-client">GUI Client</h1>
<p>Previously, in order to meet the needs of both technical and non-technical personnel for using Git, we conducted a survey of various Git clients. Currently, we have chosen the paid version of <a href="https://git-fork.com/">Fork</a>. Prior to that, we were using the most common free client, <a href="https://www.sourcetreeapp.com/">SourceTree</a>, but encountered <a href="https://community.atlassian.com/t5/Sourcetree-questions/Git-Credential-Manager-for-Windows-Popups/qaq-p/579905">issues</a> with login which happen way too often and require technical personnel to solve. As well as slowness when dealing with large files and lack of preview support for images and LFS files. Some colleagues also opted for <a href="http://gitextensions.github.io/">Git Extensions</a> bundled with <a href="https://gitforwindows.org/">Git for Windows</a>, but it&rsquo;s less user-friendly for artists, and those who are accustomed to clients with a separate window GUI may not be comfortable with just the Shell Extension. Another free option is <a href="https://tortoisegit.org/">TortoiseGit</a>, which has good support for artwork assets, including displaying images within LFS, but may not be as convenient for more complex Git commands like Blame and Rebase. <a href="https://desktop.github.com/">GitHub Desktop</a> is rudimentary. While <a href="https://www.gitkraken.com/">GitKraken</a> has many features for artwork-related tasks, it struggles with performance in large repositories due to being built on top of Electron. <a href="https://www.syntevo.com/smartgit/">SmartGit</a> has extensive features but lacks good support for artwork assets, and also has a relatively high annual fee.</p>
<figure class="center"><img src="/images/unity-git/fork.png"/><figcaption>
            <h4>Fork</h4>
        </figcaption>
</figure>

<p>Currently, Fork provides native clients for Windows and Mac, and the speed is generally good. The payment model is currently an one-time purchase of a license key able to activate on up to three computers at <a href="https://git-fork.com/buy">$50 USD</a>, which is more affordable compared to subscription-based tools (although things might change in the future). The interface is clean and satisfies most development needs, with a well-designed built-in rebase and merge interface. A killer feature for game development is the built-in image preview and diff (although the Mac version only has side-by-side view and lacks swipe and onion skin options), and it also works smoothly with LFS configuration.</p>
<figure class="center"><img src="/images/unity-git/swipe-image-diff.gif" width="400"/><figcaption>
            <h4>https://git-fork.com/blog/posts/forkwin-1.38/</h4>
        </figcaption>
</figure>

<h1 id="server">Server</h1>
<p>Most Git hosting cloud services have limitations on capacity or bandwidth for Git Large File Storage (LFS) (<a href="https://help.github.com/en/github/setting-up-and-managing-billing-and-payments-on-github/about-billing-for-git-large-file-storage">GitHub&rsquo;s LFS terms</a>), which is not ideal for game projects. Riot&rsquo;s &ldquo;Legends of Runeterra&rdquo; mentioned in their <a href="https://technology.riotgames.com/news/legends-runeterra-cicd-pipeline">shared article</a> that they use GitHub Enterprise with <a href="https://jfrog.com/artifactory/">Artifactory</a> as their LFS server. Using hosting services means Git operations have to go through the company&rsquo;s external network, which may not be practical for projects with very large assets, especially considering if the Internet conditions might not be good. If possible, it&rsquo;s recommended to set up a <a href="https://about.gitlab.com/install/">GitLab</a> instance on a dedicated server or NAS. GitLab provides Git, <a href="https://docs.gitlab.com/ee/ci/introduction/">CI Runner</a>, <a href="https://about.gitlab.com/solutions/project-management/">project management</a>, and <a href="https://docs.gitlab.com/ee/user/project/merge_requests/creating_merge_requests.html">code review</a> functionalities. Although the project management interface may not be as visually appealing or user-friendly as Trello or other tools. However, these functionalities in GitLab can reference each other, such as referencing the progress of merge requests or specific CI pipeline results in issues, which has an invaluable advantage. Just keep in mind that self-hosting requires more IT expertise and backup considerations.</p>
<figure class="center"><img src="/images/unity-git/group-issue-board.png" width="700"/><figcaption>
            <h4>https://about.gitlab.com/stages-devops-lifecycle/issueboard/</h4>
        </figcaption>
</figure>

<h1 id="external-merger">External Merger</h1>
<p>As for merge tools, most people use the built-in <a href="http://kdiff3.sourceforge.net/">KDiff3</a> in Git. However, based on my experience with Perforce from my previous job, I really like the merge tool of Perforce. Fortunately, the merge tool of Perforce, <a href="https://www.perforce.com/products/helix-core-apps/merge-diff-tool-p4merge">P4Merge</a>, can be installed separately and used for free. Most Git clients allow you to configure which external merge tool to use, and many of them can recognize P4Merge. P4Merge is very user-friendly for cherry-picking changes during 3-way merging and editing merge results, and its diff interpretation is better than other tools. Additionally, it has a powerful image diff feature that can highlight the differing pixels. The only noticeable downside is that it does not properly support non-English characters, resulting in garbled text and UI issues even if the encoding is set to UTF-8.</p>
<figure class="center"><img src="/images/unity-git/p4merge-pixel-diff.png"/><figcaption>
            <h4>P4Merge image diff</h4>
        </figcaption>
</figure>

<figure class="center"><img src="/images/unity-git/p4merge-three-way-merge.gif" width="500"/><figcaption>
            <h4>P4Merge 3-way merge</h4>
        </figcaption>
</figure>

<h1 id="configuration">Configuration</h1>
<h2 id="unity">Unity</h2>
<p>To perform version control on Unity&rsquo;s internal AssetSerialization, it is considered a must to configure Unity Editor as <a href="https://docs.unity3d.com/Manual/class-EditorManager.html">Force Text and Visible Meta Files</a>. With Force Text, Unity resources will be stored as YAML files that can be diffed, and Visible Meta Files allow GUID synchronization with other collaborators working on different machines. In the past, during the era of Unity 4.X, when the editor was 32-bit and could not address more than 4GB of memory, Force Text was sometimes disabled due to increased memory usage. However, with the current 64-bit Unity editor, this issue no longer exists, and Force Text and Visible Meta Files have become default options in later versions.</p>
<h2 id="gitconfig">.gitconfig</h2>
<h3 id="coreignorecase">core.ignorecase</h3>
<p>The most important Git config that all the team members has to set is:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">git config --global core.ignorecase true
</span></span></code></pre></td></tr></table>
</div>
</div><p>It&rsquo;s to make Git treat files with different capitalization as the same file. On systems such as Mac and Linux, which have case-sensitive file systems, files with different capitalization are treated as different files, whereas on Windows, they are considered the same file. If this setting is not configured, Mac users may push files with only different capitalization into the repository, which Windows users will be unable to pull, or encounter situations where files go back to &ldquo;Modified&rdquo; state immediately after being reverted. If you need to perform any actions that involve changing just the capitalization of a filename, please use <a href="https://git-scm.com/docs/git-mv"><code>git mv</code></a> instead of deleting the file, committing, and then renaming the file and committing again, as that may break the history of the file.</p>
<p>As we have set <code>core.ignorecase true</code>, we do not need to specifically include patterns that match different capitalizations in our configuration of <a href="https://github.com/FrankNine/RepoConfig/blob/master/.gitignore"><code>.gitignore</code></a> and <a href="https://github.com/FrankNine/RepoConfig/blob/master/.gitattributes"><code>.gitattributes</code></a>.</p>
<h3 id="corefsmonitor--featuremanyfiles">core.fsmonitor / feature.manyFiles</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">git config --global core.fsmonitor true
</span></span><span class="line"><span class="cl">git config --global feature.manyFiles true
</span></span></code></pre></td></tr></table>
</div>
</div><p>For the sheer size of game projects, it is recommended to use any settings that can improve the speed of Git operations. The <a href="https://git-scm.com/docs/git-update-index#_file_system_monitor">File System Monitor</a> can utilize operating system features to accelerate detection of file modifications, while <a href="https://git-scm.com/docs/git-config#Documentation/git-config.txt-featuremanyFiles">Many Files</a> can speed up detection of untracked files.</p>
<p>Reference:</p>
<ul>
<li><a href="https://canvatechblog.com/we-put-half-a-million-files-in-one-git-repository-heres-what-we-learned-ec734a764181">We Put Half a Million files in One git Repository, Here’s What We Learned</a></li>
</ul>
<h2 id="gitignore">.gitignore</h2>
<p>The <code>.gitignore</code> file is mainly used to ignore &ldquo;files that should stay on the local machine but should not be shared&rdquo; like Unity&rsquo;s <code>/Temp/</code> and <code>/Library/</code> directories, and the code editor settings. Files that should not be kept after use, such as Xcode project directories generated by Unity or APK files, are not included in my <code>.gitignore</code> file, so that they are recognized as Untracked Files, making it convenient to clean them up locally or on CI Runners by using <a href="https://git-scm.com/docs/git-clean"><code>git clean</code></a>. One tiny detail is that if a pattern starts with <code>/</code>, it will only match files or directories at the root of the repository. For example, I would write <code>/Library/</code> for Unity&rsquo;s Library directory to avoid ignoring other paths with the name &ldquo;Library&rdquo; inside. You can refer to the following example for setting up <code>.gitignore</code>:</p>
<p><a href="https://github.com/FrankNine/RepoConfig/blob/master/.gitignore">https://github.com/FrankNine/RepoConfig/blob/master/.gitignore</a></p>
<h2 id="gitattributes">.gitattributes</h2>
<p>The <code>.gitattributes</code> file is more complicated since it&rsquo;s related to both <a href="https://git-lfs.github.com/">LFS</a> and <a href="https://help.github.com/en/github/using-git/configuring-git-to-handle-line-endings">CRLF</a>.</p>
<h3 id="lfs-large-file-storage">LFS (Large File Storage)</h3>
<p>Let&rsquo;s talk about LFS first. Basically, LFS (Large File Storage) moves files with specific file extensions out of Git and stores them on an LFS server, leaving only a <a href="https://github.com/git-lfs/git-lfs/blob/master/docs/spec.md#the-pointer">Pointer File</a> in the original Git repository. The Pointer File contains an oid (Object ID). When needed, LFS uses the oid in the Pointer File to lookup and download the actual file from the LFS server, replacing (<a href="https://git-scm.com/book/zh-tw/v2/Customizing-Git-Git-Attributes#rfilters_a">Smudge</a> is the actual name of this process) the Pointer File with real content.</p>
<p>Here is an example of the contents of a Pointer File, which is typically around 130 bytes. Keep in mind this file size, if you see a file of this size, you may need to check if the LFS replacement process was executed correctly.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">version https://git-lfs.github.com/spec/v1
</span></span><span class="line"><span class="cl">oid sha256:4d7a214614ab2935c943f9e0ff69d22eadbb8f32b1258daaa5e2ca24d17e2393
</span></span><span class="line"><span class="cl">size 12345
</span></span><span class="line"><span class="cl">(ending \n)
</span></span></code></pre></td></tr></table>
</div>
</div><p>Nowadays, most Git clients are capable of detecting LFS and automatically setting up LFS configuration during cloning. However, if there are issues with LFS initialization, you can manually execute the following commands:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">git lfs install
</span></span><span class="line"><span class="cl">git lfs pull
</span></span></code></pre></td></tr></table>
</div>
</div><p>Using LFS can reduce the size of Git history, as Git only stores Pointer Files. This can decrease the local disk space usage during cloning and improve efficiency, especially for large binary files in 3D game projects. However, there are some drawbacks:</p>
<ul>
<li>Git operations now require continuous communication to the LFS server, which results in the loss of Git&rsquo;s fully distributed and offline capability.</li>
<li>Occasionally, issues may arise with LFS replacement, such as Pointer Files not being replaced with the actual file contents during cloning or fetching. Rarely, there may be cases where files are lost in GitLab&rsquo;s LFS server, resulting in failed fetches. In situations where LFS and Fork functionality are used simultaneously in GitLab, <a href="https://gitlab.com/gitlab-org/gitlab/-/issues/271576">re-synchronization</a> may be needed for the LFS repository. It is currently recommended to avoid using LFS and Fork functionality together on GitLab.</li>
<li>Some features may not work properly in an LFS environment, including certain tools that may not be able to diff LFS files, and <a href="https://gitlab.com/gitlab-org/gitlab-runner/-/issues/4040"><code>gitlab-runner exec</code> unable to run in an environment with LFS files</a>.</li>
</ul>
<p>It is recommended for game projects to use LFS since the majority of the repository size is from binary files, and it is better to adopt LFS early on. Because binary files that have already been committed into the Git history will remain in the history, and modifying <code>.gitattributes</code> will only affect newly added files. If the repository size becomes unmanageable, migrating to LFS may be the only option, but it requires all users to clone the repository again, which can be a massive undertaking.</p>
<p>To perform migration to LFS on existing repository, first, track all branches locally, as <code>lfs migrate</code> only applies to local branches:<br>
<a href="https://stackoverflow.com/questions/379081/track-all-remote-git-branches-as-local-branches">https://stackoverflow.com/questions/379081/track-all-remote-git-branches-as-local-branches</a></p>
<p>Then execute following commands (This is an example of rewriting history for <code>.png</code> and <code>.psd</code> files from binary blobs to LFS pointers)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">git lfs migrate import --everything --include<span class="o">=</span><span class="s2">&#34;.png,.psd&#34;</span>
</span></span><span class="line"><span class="cl">git reflog expire --expire<span class="o">=</span>now --all <span class="o">&amp;&amp;</span> git gc --prune<span class="o">=</span>now
</span></span><span class="line"><span class="cl">git remote set-url origin &lt;New repository location&gt;
</span></span><span class="line"><span class="cl">git push --all origin --force
</span></span></code></pre></td></tr></table>
</div>
</div><p>Another common situation is that you modify the <code>.gitattributes</code> file to include new file extensions into the LFS scope, but the existing files are not replaced with Pointer Files. In this case, you will receive a following warning during Clone or Reset:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Encountered 1 file(s) that should have been pointers, but weren&#39;t
</span></span></code></pre></td></tr></table>
</div>
</div><p>If you don&rsquo;t want to rewrite whole history but just want to replace current files with Pointer Files, you can use:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># from https://stackoverflow.com/a/51626808</span>
</span></span><span class="line"><span class="cl">git rm --cached -r .
</span></span><span class="line"><span class="cl">git reset --hard
</span></span></code></pre></td></tr></table>
</div>
</div><p>Or</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># from https://github.com/git-lfs/git-lfs/issues/3421#issuecomment-610489798</span>
</span></span><span class="line"><span class="cl">git add --renormalize .
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then commit/push the changes to the repository.</p>
<p>Just add the following to <code>.gitattributes</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">*.png filter=lfs diff=lfs merge=lfs
</span></span></code></pre></td></tr></table>
</div>
</div><p>You can manage PNG image files with LFS like this (since <code>core.ignorecase true</code> is set, we don&rsquo;t need to write <code>*.png</code> as <code>*.[pP][nN][gG]</code>). Basically, all binary files that cannot be directly edited as text should be added to LFS, but for Unity Prefab (<code>.prefab</code>), Assets (<code>.Assets</code> but not <code>LightingData.asset</code>) and Scene (<code>.unity</code>) files, I would choose not to add them to LFS. After setting AssetSerialization to Force Text, the YAML structure of Unity GameObjects can be read and compared as text diff, which can be very helpful to verify if intended changes to Prefabs or Scenes accidentally affect other <a href="https://docs.unity3d.com/ScriptReference/SerializeField.html">SerializedFields</a>.</p>
<p>To understand how to read YAML, you can refer to the official documentation:<br>
<a href="https://blog.unity.com/technology/understanding-unitys-serialization-language-yaml">Understanding Unity’s serialization language, YAML</a></p>
<p>If you would like to read changes in Scenes and Prefabs this way, remember to use <a href="https://docs.unity3d.com/ScriptReference/AssetDatabase.ForceReserializeAssets.html">AssetDatabase.ForceReserializeAssets</a> on all Prefab and Scene files when upgrading Unity to the newer version. By default, Unity only upgrades YAML file format to new version when changes are made (this is a design philosophy of Unity Editor, Material files are also exhibiting this kind of lazily upgrade behavior), but this can result in editing changes and upgrade changes getting mixed together that makes it difficult to read in diff. Therefore, it is necessary to force the file upgrade via <code>AssetDatabase.ForceReserializeAssets</code> when Unity is upgraded but the project is not yet modified.</p>
<p>Unity provides its own <a href="https://docs.unity3d.com/Manual/SmartMerge.html">YAML merger</a>, but after trying it, I found that the results are occasionally very strange. Currently, I only read YAML diff and don&rsquo;t automatically merge Scenes and Prefabs with this tool.</p>
<p>Another special case is <code>.dll</code>. When a DLL is not LFS smudged correctly, it will cause compilation errors. If Unity complains about being unable to find symbols that should have been defined in the DLL, remember to check if the file size of the DLL file in the project see if it&rsquo;s only 130-byte. Which means it is just a Pointer File, and the LFS execution failed.</p>
<h3 id="crlf">CRLF</h3>
<p>Another big pitfall with <code>.gitattributes</code> is <a href="https://blog.miniasp.com/post/2013/09/15/Git-for-Windows-Line-Ending-Conversion-Notes">CRLF</a> handling, as Windows (CRLF <code>\r\n</code>), Mac (CR <code>\r</code> before OSX, LF <code>\n</code> after), and Linux (LF <code>\n</code>) have different line endings. Git defaults to <code>autocrlf</code>, which automatically converts line endings during checkout and commit. However, if not configured carefully, this can cause two issues:</p>
<ul>
<li>Applying conversion to binary files that are not actually text files, resulting in corrupted files when opened locally.</li>
<li>Some files constantly change line endings, most commonly <code>.meta</code> files, causing numerous changes in changelist that are not man-made.</li>
</ul>
<p>Many people may use this popular Unity <code>.gitattributes</code> config:<br>
<a href="https://gist.github.com/nemotoo/b8a1c3a0f1225bb9231979f389fd4f3">https://gist.github.com/nemotoo/b8a1c3a0f1225bb9231979f389fd4f3</a></p>
<p>But it sets Unity&rsquo;s <code>.asset</code> files to LF, and Unity has many types of <code>.asset</code> files, as I previously investigated:</p>
<ul>
<li>CRLF
<ul>
<li><code>.asset</code> files under <code>ProjectSettings</code> folder</li>
</ul>
</li>
<li>LF
<ul>
<li><a href="https://docs.unity3d.com/Manual/class-Tilemap.html">Tilemap</a> configuration files</li>
</ul>
</li>
<li>Still binary under Force Text setting
<ul>
<li><a href="https://docs.unity3d.com/Manual/LightmapSnapshot.html">Lighting Data</a></li>
<li><a href="https://docs.unity3d.com/Manual/terrain-UsingTerrains.html">Terrain Data</a></li>
</ul>
</li>
</ul>
<p>Forcing conversion to LF can cause issues, as reported by others but there&rsquo;s no update yet, so it is recommended not to use this <code>.gitattributes</code> sample.</p>
<p>My final configuration starts with:</p>
<p><code>* -text</code></p>
<p>Text attribute is removed to disable line ending conversion for all files by default. Then, using the trait of <code>.gitattributes</code>, the rules written below can override the rules written above. Adding line ending conversion for pure text files in a whitelist manner.</p>
<p>Not written as:</p>
<p><code>* binary</code></p>
<p>This is because <a href="https://git-scm.com/docs/gitattributes#_using_macro_attributes">Binary</a> represents <code>-text -diff</code>, and we want to disable line ending conversion but keep text diff for <code>.scene</code>, <code>.prefab</code>, and <code>.meta</code> files. This allows us to observe changes in GameObjects, Components, or GUID changes in <code>.meta</code> files through diffs.</p>
<figure class="center"><img src="/images/unity-git/prefab-diff.png"/><figcaption>
            <h4>In the case where Prefab is not added to LFS and does not have -diff, the diff in the Git client will be displayed like this. You can see that we changed the size of RectTransform to 200 x 200, but accidentally turned off the GameObject at the same time.</h4>
        </figcaption>
</figure>

<figure class="center"><img src="/images/unity-git/meta-diff.png" width="600"/><figcaption>
            <h4>Seeing changes in GUID inside `.meta` files in changelist is very dangerous, as it indicates that Unity references may be lost.</h4>
        </figcaption>
</figure>

<p>As for the issue of inconsistent line endings in <code>.meta</code> files, it was found through experimentation that Unity Editor saves them with LF line endings regardless of the OS, so it is hardcoded:</p>
<p><code>*.meta text eol=lf</code></p>
<p><code>&quot;.mat&quot;</code> files should also be forcing LF line endings, but they don&rsquo;t usually have the line ending flip-flopping issue like <code>.meta</code> files, so we did not hard-code it.</p>
<p>As for the source code files that are edited via text editors, those file should apply <code>text</code> attribute to override &ldquo;* -text&rdquo; to ensure consistent line endings for these files in the repository, to prevent interference with readability of Git commands like <code>git blame</code> due to line ending fluctuations.</p>
<p>Previously, the setting was set to <code>autocrlf</code>, but in the updated versions, we have switched to using LF uniformly.</p>
<p><code>*.cs text eol=lf</code></p>
<p>Since we are trying to calculate a custom source hash for AssetBundles, which includes all the source materials of the AssetBundle as well as all the source code files as hashing input. Source code is included because the code may have <a href="https://docs.unity3d.com/ScriptReference/AssetImporter.html">AssetImporter</a> that can affect the import result. To ensure that the source hash calculation results are consistent between Windows and Mac, we now uniformly force LF line endings to make the binary representation of source files the same on both platforms. Most code editors on Windows can still function properly with LF line endings, so the impact is minimal.</p>
<p>P.S.
(Modifications to asmdef can affect the Assembly names and <a href="https://forum.unity.com/threads/asset-bundle-cannot-find-scripts-from-assembly-definition-files.531804/#post-3521699">prevent AssetBundle from dereferencing MonoBehaviour attached to GameObject</a>. If you want to control whether AssetBundle updates based on custom source hash, you need to track asmdef changes as well.)</p>
<p>To use Windows CRLF and Mac LF line endings for source files like OS default, you can apply the following setting instead:</p>
<p><code>*.cs text=auto</code></p>
<p>Finally, you can refer to the complete <code>.gitattributes</code> settings for the entire setup:
<a href="https://github.com/FrankNine/RepoConfig/blob/master/.gitattributes">https://github.com/FrankNine/RepoConfig/blob/master/.gitattributes</a></p>
<h2 id="editorconfig">EditorConfig</h2>
<p><a href="https://editorconfig.org/">https://editorconfig.org/</a></p>
<p>This is not directly related to Git itself, but it&rsquo;s a configuration file that can be included in the repository, so I&rsquo;ll mention it here as well. Currently, we are using a very barebone configuration:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">root = true
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[*]
</span></span><span class="line"><span class="cl">charset = utf-8
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">indent_style = space
</span></span><span class="line"><span class="cl">indent_size  = 4
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">trim_trailing_whitespace = true
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>.gitattributes</code> controls line endings, but source files may still have issues with text encoding, BOM, or inconsistent Tab/Space. Encoding and Tab/Space can be managed using a <code>.editorconfig</code> file placed within the project to provide guidance to the source editors on how to handle them. Currently, Visual Studio, MonoDevelop, and Rider automatically detect settings from <code>.editorconfig</code>, while Visual Studio Code and Notepad++ require plugins to be installed.</p>
<p>Furthermore, Visual Studio or ReSharper settings can also be committed to the repository to achieve consistency in naming or coding conventions among the entire team. However, our company does not have practical experience in this practice as there is no unified adoption of JetBrains editors yet.</p>
<h1 id="worktree">Worktree</h1>
<p>If you&rsquo;re developing multi-platform games, you may find it convenient to clone the same project multiple times and configure each clone to a different platform, such as one clone for Android and another for iOS. Although <a href="https://docs.unity3d.com/Manual/CacheServer.html">Cache Server</a> / <a href="https://docs.unity3d.com/Manual/UnityAccelerator.html">Accelerator</a> or <a href="https://forum.unity.com/threads/what-is-asset-database-v2.680170/">AssetDatabase V2</a> can reduce the cost of switching platforms, keeping multiple copies of the project on your hard drive is still the fastest and most intuitive way. The downside is that it consumes a lot of disk space. However, you can actually clone the project <code>.git</code> folder once and then use multiple <a href="https://git-scm.com/docs/git-worktree">Worktree</a>, which means you&rsquo;ll still have multiple project directories, but only one <code>.git</code> folder, resulting in only one Git history on your computer. Also if you have concerns about disk space and your computer has a large traditional hard drive but limited SSD space, you can consider storing the Git history on the traditional hard drive and placing the project Worktrees on the SSD.</p>
<p>To do this in the Git root directory:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">git worktree add ../project-ios
</span></span></code></pre></td></tr></table>
</div>
</div><p>It will create an additional Worktree named <code>project-ios</code> in the parent directory:</p>
<p>Extra Worktrees can be recognized by most regular Git clients, and the operations are similar to a regular clone.</p>
<p>To list the existing Worktrees, use the following command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">git worktree list
</span></span></code></pre></td></tr></table>
</div>
</div><p>When you no longer need a Worktree, you can simply delete it and then run:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">git worktree prune
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="hooks">Hooks</h1>
<p>Git allows you to add automatic triggering Shell Scripts in the settings for auto integrity checking or cleaning, it&rsquo;s commonly used for clearing empty directories and their <code>.meta</code> files, as well as checking if corresponding <code>.meta</code> files are added when committing new files. However, I haven&rsquo;t personally promoted this practice to the entire team, so I don&rsquo;t have much personal experience to share. You can refer to the following resources:</p>
<ul>
<li><a href="https://pre-commit.com/">pre-commit</a></li>
<li><a href="https://github.com/doitian/unity-git-hooks">doitian/unity-git-hooks</a> (for cleaning empty directories and checking .meta files)</li>
</ul>
<p>If given the opportunity, I would prefer to implement this using a language like Python, as the logic would be easier to understand. Additionally, empty directory <code>.meta</code> files usually do not cause problems, so I don&rsquo;t feel pressured to use hooks to check for them (Missing <code>.meta</code> files in commits are also rare after promoting awareness to the team, but automated checks are always helpful). However, one situation to note is the <code>.framework</code> and <code>.bundle</code> folders in iOS and Mac environments, which contain plugins and have Import Settings stored in <code>.meta</code> files. If the <code>.meta</code> files of these directories are not properly removed when <code>.framework</code> or <code>.bundle</code> folders are deleted, Xcode may attempt to import them as empty plugins and fail to build.</p>
<h1 id="rebase">Rebase</h1>
<p>I am used to the process of forked repository, fetch Upstream, push Origin, and open Merge Request, as well as add other colleagues&rsquo; forks as other remotes. I am also used to using <a href="https://git-scm.com/docs/git-rebase">Rebase</a> or <a href="https://git-scm.com/docs/git-cherry-pick">Cherrypick</a> to modify Git branch history. If someone merges to the main branch before I do, I will Rebase my own branch to the HEAD of main branch and then open a new Merge Request with <code>--no-ff</code> (<a href="https://git-scm.com/docs/git-merge#Documentation/git-merge.txt---no-ff">no fast-forward</a> to create a non-overlapping branch merge in the history, which makes it easy to trace in the future. Another situation is when a feature changes X to Y, but later it turns out that it was a mistake and it should be changed to Z instead. In such cases, I will try to modify the history to be X -&gt; Z before submitting the Merge Request, instead of X -&gt; Y -&gt; Z, to reduce the burden on reviewers. I feel that these operations could be included in the Code Review standards, but currently, I only do these operations myself due to time constraints and I don&rsquo;t have experience promoting to others.</p>
<figure class="center"><img src="/images/unity-git/merge-rebase.png"/><figcaption>
            <h4>The difference in history between using Merge and Rebase followed by a merge with the `--no-ff` flag. Rebase is more understandable shown on the right side (history shown is for demonstration purposes only, actual work situations may be more complex).</h4>
        </figcaption>
</figure>

<p>Reference:</p>
<ul>
<li><a href="https://www.bitsnbites.eu/a-tidy-linear-git-history/">A tidy, linear Git history</a></li>
</ul>
<p>For non-technical users, performing a rebase instead of a merge may be more challenging, but if everyone uses default pull, it may result in a large number of overlapping merge commits. One approach is to set up <a href="https://git-scm.com/docs/git-config#Documentation/git-config.txt-pullrebase">pull.rebase</a> and <a href="https://git-scm.com/docs/git-config#Documentation/git-config.txt-rebaseautoStash">rebase.autoStash</a> for non-technical users.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">git config pull.rebase true
</span></span><span class="line"><span class="cl">git config rebase.autoStash true
</span></span></code></pre></td></tr></table>
</div>
</div><p>This approach triggers stash, rebase, and apply stash during pull, replacing merge operation during pull, which can be effective in reducing overlaps. However, the downside is that if conflicts arise, rebase conflicts are harder to deal with than merge conflicts. Whether to apply this approach or not depends on the level of acceptance among non-technical team members.</p>
<p>Rebasing forward will let feature branches get the new commits on main branches. While another approach is to merge the main branch into the feature branch. However, with this approach, it is important to communicate to all team members to be careful with resolving conflicts during merging. If merge conflict resolutions are done incorrectly during merging main branch to feature branch, there will be no warning when merging feature branches back to the main branch, as conflicts have already been marked as resolved in earlier merges. Non-technical team members may occasionally make this mistake, but such mistake can have serious consequences as it can pollute the main branch. Extra caution is needed if you choose not to use rebase to get new changes.</p>
<h1 id="sparse-checkout--shallow-clone">Sparse checkout &amp; Shallow clone</h1>
<p>During checkout, it is not necessary to checkout the entire repository. Instead, you can specify file or folder patterns in <code>.git/info/sparse-checkout</code> to only checkout specific files or folders. The following is an example of cloning and checking out only <code>/Assets/</code> and <code>/ProjectSettings/</code> folders.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">git clone --no-checkout &lt;Repo URI&gt;
</span></span><span class="line"><span class="cl">cd &lt;Repo path&gt;
</span></span><span class="line"><span class="cl">git config core.sparseCheckout true
</span></span><span class="line"><span class="cl">(echo /Assets/) &gt; .git/info/sparse-checkout
</span></span><span class="line"><span class="cl">(echo /ProjectSettings/) &gt;&gt; .git/info/sparse-checkout # &gt;&gt; means append
</span></span><span class="line"><span class="cl">git checkout
</span></span></code></pre></td></tr></table>
</div>
</div><p><a href="https://github.blog/2020-01-13-highlights-from-git-2-25/">Git 2.25.0</a> introduced <a href="https://github.blog/2020-01-17-bring-your-monorepo-down-to-size-with-sparse-checkout/"><code>git sparse-checkout</code></a>, which allows you to use <code>git sparse-checkout init</code> instead of <code>git config core.sparseCheckout true</code> <a href="https://git-scm.com/docs/git-sparse-checkout#Documentation/git-sparse-checkout.txt-emsetem"><code>git sparse-checkout set/add</code></a> replacing directly editing <code>.git/info/sparse-checkout</code>.</p>
<p>Additionally, <code>git clone</code> can be used with the <a href="https://git-scm.com/docs/git-clone#Documentation/git-clone.txt---depthltdepthgt"><code>--depth</code></a> parameter to limit the depth of the cloned history.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">git clone --depth 5 -b &lt;Branch&gt; &lt;Repo URI&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>If you want to restore, execute:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">git fetch --unshallow
</span></span></code></pre></td></tr></table>
</div>
</div><p>Sparse Checkout and Shallow Clone can both speed up Git operations and reduce disk space usage, but they are not commonly used on clones for authoring. The more practical application is to use them on Build Pipelines, where you can control the behavior of Clone and Checkout on the Build Server to achieve faster build times as you only need HEAD to build the project.</p>
<p>Git 2.34 introduced a more aggressive  <a href="https://github.blog/2021-11-10-make-your-monorepo-feel-small-with-gits-sparse-index/">Sparse Index</a> feature, which allows you to even sparse checkout the Git index. It&rsquo;s mainly for a Monorepo-style project. However, we are not currently using Monorepo, and I personally have some doubts about the workflow of removing things to return to a non-Monorepo state after using Monorepo. Let&rsquo;s not delve into this discussion for now.</p>
<h1 id="branching-model">Branching Model</h1>
<p>After using it for a long time, the once popular <a href="https://nvie.com/posts/a-successful-git-branching-model/">Git Flow</a> has been abandoned by us, as the benefits it brings are not outweighing the difficulties caused by its complexity (<a href="https://news.ycombinator.com/item?id=22496724">Hacker News discussion</a>). This is especially challenging to implement in game development teams where not everyone has a technical background to be able to jump back and forth between branches.</p>
<p>In addition, Git Flow does not emphasize that the lifecycle of Feature Branches should be short and should be merged into the main branch frequently. If you have long Feature Branches, it means the project is not integrated. <strong>Creating long-lived Feature Branches does not provide you with an isolated working environment; it only gives the illusion of working independently</strong>. The real effect is delaying the cost of integration, but when it&rsquo;s time to integrate, you pay a compounded cost. If you have experienced situations where several people want to merge into the main branch right before the end of a sprint or milestone, resulting in conflicts and unstable code on the main branch that cannot be fixed due to time constraints, then you understand what I mean.</p>
<p>We are now transitioning to <a href="https://trunkbaseddevelopment.com/">Trunk-Based Development</a>, where short Feature Branches are quickly merged into the main branch, or long Feature Branches are merged into the main branch periodically using <a href="https://martinfowler.com/bliki/BranchByAbstraction.html">Branch by Abstraction</a> and <a href="https://www.martinfowler.com/articles/feature-toggles.html">Feature Toggles</a>, allowing unfinished features to be merged without affecting others, thus spreading the cost of integration. If you are running Scrum, sometimes you will encounter situations where features are not fully completed by the end of a sprint. If these features are all kept in Feature Branches that haven&rsquo;t been merged for a long time, it can be very troublesome to carry them over to the next sprint. This creates a lot of pressure to integrate them by the end of the sprint. However. If the features are controlled by Feature Toggles, they can be merged in smaller increments, and then re-evaluated and planned for the next sprint. After the features are completed, the Feature Toggles are typically removed, but they can also be kept in place for A/B testing or remote configuration control purposes.</p>
<p>In addition, Code Review is more suitable for environments where frequent merging via Merge Requests is practiced. In general, the amount of code that one can effectively review at a time is limited. Reviewing changes that have been in development for more than a week can be very challenging, and beyond that, it becomes a torture for the reviewer.</p>
<h1 id="lfs-lock">LFS Lock</h1>
<p>In git LFS v2.0.0, a new feature was added to <a href="https://github.com/git-lfs/git-lfs/wiki/File-Locking">lock</a> specific files, and the Fork client also supports LFS Lock from the GUI. To declare a file as lockable, add <code>lockable</code> in the <code>.gitattributes</code> file.(In fact, it seems that you can <code>git lfs lock</code> on files without the <code>lockable</code> attribute. The only difference seems that if a file is marked <code>lockable</code> on <a href="https://github.com/git-lfs/git-lfs/blob/94245ec834c7f938ec3a7808f73e9bd1d2b04f0a/docs/man/git-lfs-post-commit.1.ronn#description">commit</a>, git LFS will automatically add the read-only attribute to files if it hasn&rsquo;t been <code>git lfs lock</code> yet.)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">*.jpg filter=lfs diff=lfs merge=lfs -text lockable
</span></span></code></pre></td></tr></table>
</div>
</div><p>After that, you can use <code>lock</code> and <code>unlock</code> commands.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">git lfs lock &lt;file path&gt;
</span></span><span class="line"><span class="cl">git lfs unlock &lt;file path&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>Although this feature feels like it could implement a file locking mechanism similar to checkout in Perforce, currently it still requires manual checking of lock status, which is not very convenient. Therefore, it has not been widely adopted in projects, but I believe it has the potential to be a promising direction. <del>Hopefully, future versions will improve or provide methods, such as hooks, to automatically lock files when detecting file edits, just like Perforce.</del></p>
<p>Later, I tried automating the process of setting files as read-only and then releasing the read-only flag only after LFS Lock, mimicking Perforce&rsquo;s behavior. However, I realized that <a href="https://forum.unity.com/threads/why-does-unity-unlock-a-read-only-file.35462/#post-230437">Unity Editor itself does not respect the system&rsquo;s read-only flag</a>, as Unity just removes read-only flags on files in Assets directory. Unable to distinguish whether the read-only flag was removed by the hook or by Unity. This forced me to abandon the idea and left me curious about how Perforce could be working with Unity, given Unity does not respect the read-only flag.</p>
<p>In addition, it seems that the improvements users expected, such as <a href="https://github.com/git-lfs/git-lfs/issues/3637">Per-branch Lock</a> and <a href="https://github.com/git-lfs/git-lfs/issues/2671#issuecomment-349458133">Auto Unlock</a>, have been shelved for a long time. It seems unnecessary to invest further in researching LFS Lock until these major issues are resolved.</p>
<h1 id="vfs-for-git">VFS for Git</h1>
<p><a href="https://vfsforgit.org/">VFS for Git</a> is a solution proposed by Microsoft for managing the large and old Windows repository using Git. It relies on the underlying <a href="https://docs.microsoft.com/zh-tw/windows/win32/projfs/projected-file-system">ProjFS</a> virtual file system. When using <code>gvfs clone</code>, you may see files exist on the disk but without content, and attempting to open and read the files will trigger blocking and ProjFS will start to download the content from the server. Testing <code>gvfs clone</code> was indeed very fast as Microsoft claimed, completing under one minute. The actual contents are automatically downloaded when opening the Unity project, as it intervenes at the file system level, and requires no modification for Unity 2020 and later versions to work. However, Unity Editor still scans the entire <code>/Assets/</code> folder to build the AssetDatabase every time it is executed, which means that the entire <code>/Assets/</code> folder is still processed and downloaded. To fully enjoy the benefits of only downloading files that are needed for editing, the engine needs to have a system that only touches files when they are needed.</p>
<figure class="center"><img src="/images/unity-git/vfs-for-git-windows.png"/><figcaption>
            <h4>Even though Microsoft claims that the Windows repository is very large.</h4>
        </figcaption>
</figure>

<figure class="center"><img src="/images/unity-git/spider-man.png"/><figcaption>
            <h4>To be honest, compared to game repositories, it still doesn&#39;t feel very large.</h4>
        </figcaption>
</figure>

<p>Although it looks impressive, it is still not feasible to consider adopting it at this stage. The main reason is that there are very few supported Git servers. Only Azure Repos is supported, and it has a <a href="https://docs.microsoft.com/en-us/azure/devops/repos/git/limits?view=azure-devops#repository-size">250GB size limit</a> which might make it impractical for larger projects. <a href="https://github.com/microsoft/VFSForGit/issues/1640#issuecomment-590880312">GitHub</a> and <a href="https://gitlab.com/gitlab-org/gitlab-foss/-/issues/27895">GitLab</a> do not seem to be actively interested in supporting it.</p>
<p>For those who are still interested in trying, there are several points to note when implementing VFS for Git:</p>
<ul>
<li>Only Azure Repos is supported.</li>
<li>The Git repository must be in a non-LFS state. If it is already using LFS, you need to reverse it using <code>git lfs migrate export</code> to restore the state where binary files are directly committed in Git history.</li>
<li>The contents of <code>.gitattributes</code> file must be removed from history using rebase, leaving only <code>* -text</code>. VFS for Git does not allow any <a href="https://github.com/microsoft/VFSForGit#trying-out-vfs-for-git">.gitattributes conversion</a>.</li>
<li>You must use the <a href="https://github.com/microsoft/git">Forked Git</a> from Microsoft. Microsoft claims that even without using VFS for Git, this Fork can provide some acceleration for general Git operations. However, I encountered some issues with uncertain reasons and ended up going back to using the version built into the GUI client after experimenting with VFS for Git.</li>
</ul>
<h1 id="single-source-of-truth">Single Source of Truth</h1>
<p>Because we used <a href="https://www.mercurial-scm.org/">Mercurial</a> to manage our project before Git, there was a period of time during the transition to Git where developers switched to Git while artists continued to work with Mercurial. Syncing changes between the two became extremely difficult, as we had to constantly find the synchronization points then jump back and forth to trace the history. It was especially challenging when we needed to release hotfixes urgently. Eventually, we couldn&rsquo;t bear the complexity and decided to enforce the use of Git for all team members. That&rsquo;s the reason why surveying clients for non-technical users came up earlier.</p>
<p>This experience made me realize that the data that makes up a game should be stored in the same history, i.e., the same repository. This has discouraged me from considering tools like <a href="https://www.perforce.com/perforce/r15.3/manuals/git-fusion/">Git Fusion</a> or <a href="https://git-scm.com/docs/git-svn">git-svn</a> for syncing across version control systems. Instead, we now use Git exclusively and try to address pain points for non-technical users. At the same time, we have gradually reduced the usage of <a href="https://git-scm.com/book/en/v2/Git-Tools-Submodules">git submodule</a>, as synchronizing submodules with the main repository&rsquo;s history can easily lead to errors. Shared libraries are now managed in a more traditional way, where we tag and version them, create installation packages, and have each project commit the library content directly into their own repository.</p>
<p>Continuing with the idea that all the data that makes up a game should be stored in the same history, the source code of the server and the game data tables should also be placed in the same repository as the client project (Or even written in the same language: <a href="https://github.com/Cysharp/MagicOnion">MagicOnion</a>). When changes to the game data format are needed, a single commit would include synchronized updates for the server, client, and data tables (using a cross-language definition like ProtoBuf), eliminating issues caused by inconsistencies in server, client, and data schema. However, the challenge lies in the lack of readily available editing tools for the game data. Designers still have to edit the data in Google Sheets and download it, so this idea remains in the realm of my own imagination.</p>
<p>For discussions on game data editing tools, please refer to: [link reference]</p>
<ul>
<li><a href="https://blog.demofox.org/2016/04/01/game-development-needs-data-pipeline-middleware/">Game Development Needs Data Pipeline Middleware</a></li>
</ul>
<h1 id="why-git">Why Git？</h1>
<p>In fact, enabling LFS or VFS for Git removes the decentralized nature of Git, and using Thunk-based approaches reduces the need for branch capabilities of Git. We were also trying to enable Lock on top of LFS. Many people ask why not simply use SVN, Perforce, or switch to <a href="https://www.plasticscm.com/">Plastic</a> as some developers have mentioned while I was drafting this article. I have thought about it but have not been able to come up with a good answer. It seems that Git was not designed with consideration for common use cases in game development, such as large files and unmergeable binary files. Instead, LFS is used as a plugin to address these issues within the Smudge/Clean system. This article largely deals with the challenges that arise from this plugin-based approach. When our company migrated from Mercurial to Git, it was primarily because we felt that Mercurial had less development momentum compared to Git. Mercurial lacked suitable tools for Merge Request and Code Review at that time, while Git had Gerrit, GitHub, and later GitLab, which provided more options for code collaboration. Git also had a more dynamic and innovative client ecosystem compared to the limited options available for Mercurial. So, is this a case of Worse is Better as described in <a href="http://dreamsongs.com/WorseIsBetter.html">&ldquo;Worse is Better&rdquo;</a>? Perhaps it is (not to say that Mercurial is inherently better, as I honestly do not know what &ldquo;better&rdquo; means in this context).</p>
<p>I believe that regardless of the reasons why you chose to use Git for version control in your Unity project, I can at least offer some experience and assistance here. I do not think that Git is the only option, and if you have a preferred alternative, that&rsquo;s great too! Feel free to share your experiences. If you have no opinion about which to use, it may be beneficial to use the one with more resources and larger community where more users can provide insights and help with troubleshooting.</p>
<p>I hope this article can help those who have struggled with Git to spend less time wrestling with it and more time developing games. Goodbye for now, and hope to see you again.</p>
<h1 id="acknowledgements">Acknowledgements</h1>
<p>I&rsquo;d like to thank following people for reviewing and providing suggestions for this article draft: 包子, 小善學長, 小金學長, Hugo, 建豪, 蒼時, 頭皮, Colin, 于修, Denny, JohnSu, Recca, Jonas and all the other friends. Feel free to leave comments if you have any additional points or discussions to add.</p>

  </div>
</article>
        </div>
        

  

  
    <script src="https://utteranc.es/client.js"
            repo="FrankNine/franknine.github.io"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="FrankNine" class="iconfont icon-thub" title="thub"></a>
      <a href="aaefiikmnnnr" class="iconfont icon-itter" title="itter"></a>
  <a href="https://franknine.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2010 - 
    2023<span class="heart"><i class="iconfont icon-heart"></i></span><span>Chun-Fu Chao</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








</body>
</html>
