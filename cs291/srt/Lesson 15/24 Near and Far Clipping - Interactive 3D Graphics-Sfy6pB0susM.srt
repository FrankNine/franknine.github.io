1
00:00:00,001 --> 00:00:03,962
你現在看到的是在場景裡移動遠、近裁切面的效果

2
00:00:03,987 --> 00:00:06,966
看到這種裁切通常是 bug 不是功能

3
00:00:06,991 --> 00:00:12,657
光線追蹤演算法沒有這種問題，因為他們機制只是從眼睛發出射線

4
00:00:12,682 --> 00:00:18,893
柵格化需要遠近這兩個值才能運作正常，因為需要建構投影矩陣

5
00:00:18,918 --> 00:00:21,332
嗯，至少近的值必須被設定

6
00:00:21,357 --> 00:00:25,768
是有可能建構沒有距離上限的視錐的投影矩陣

7
00:00:25,793 --> 00:00:30,591
這兩個值的關鍵在你要盡可能設定成靠近

8
00:00:30,616 --> 00:00:33,050
但不能發生裁切

9
00:00:33,075 --> 00:00:37,662
近裁切面要盡可能遠離攝影機

10
00:00:37,686 --> 00:00:41,165
遠近兩個值會決定 Z 緩衝區的計算

11
00:00:41,190 --> 00:00:45,920
機器內部 Z 緩衝區通常是幾位元的整數

12
00:00:45,945 --> 00:00:48,085
24 bits 算是常見

13
00:00:48,110 --> 00:00:50,620
剩下 8 bits 用在 Stencil 緩衝區

14
00:00:50,645 --> 00:00:56,349
這是另一個緩衝區我不會在這門課教到，但能用在螢幕上裁切或是其他效果

15
00:00:56,374 --> 00:00:59,831
Z 緩衝區有很多位元，但不是無限的

16
00:00:59,856 --> 00:01:02,993
假設你要繪製桌上的一張紙

17
00:01:03,018 --> 00:01:04,614
很容易產生 Z-Fighting

18
00:01:04,639 --> 00:01:08,734
即使建模都正確，紙也稍稍高過桌面

19
00:01:08,758 --> 00:01:12,694
在某些像素，紙和桌面的 Z 值會相同

20
00:01:12,719 --> 00:01:14,825
桌面就會透出來

21
00:01:14,850 --> 00:01:18,627
Z 深度值域分布在遠近距離值之間

22
00:01:18,652 --> 00:01:22,845
這兩個值越接近，對精確度越好

23
00:01:22,870 --> 00:01:28,383
然而對投影座標變換，你要將近裁切面放得離眼睛越遠越好

24
00:01:28,408 --> 00:01:29,816
這裡有個例子

25
00:01:29,841 --> 00:01:35,195
假設近裁切面在離眼睛一單位的位置，遠裁切面在十單位

26
00:01:35,220 --> 00:01:40,061
NDC Z 深度不是線性的，而是某種雙曲函數曲線

27
00:01:40,086 --> 00:01:43,139
設想有個物件在七單位遠

28
00:01:43,164 --> 00:01:48,136
近裁切面在 1 時，NDC Z 值大約在 0.9

29
00:01:48,161 --> 00:01:51,960
較遠的物件 Z 深度會偏高

30
00:01:51,985 --> 00:01:55,864
這些較遠的物件必須共用有限的 Z 深度範圍

31
00:01:55,888 --> 00:01:58,311
所以更可能發生 Z-Fighting

32
00:01:58,336 --> 00:02:02,895
Z 值是曲線不是線性跟內插有關

33
00:02:02,920 --> 00:02:06,732
我們希望直線在透視投影後還是直線

34
00:02:06,757 --> 00:02:10,684
我不會在這裡證明，但是想像遠端消失的鐵軌

35
00:02:10,709 --> 00:02:13,679
距離攝影機近，鐵軌看起來較遠

36
00:02:13,704 --> 00:02:17,502
當你往地平線去，鐵軌越來越近

37
00:02:17,527 --> 00:02:20,041
鐵軌的距離當然都是一樣的

38
00:02:20,066 --> 00:02:21,644
鐵軌也保持直的

39
00:02:21,669 --> 00:02:24,577
但是在成像上的距離改變了

40
00:02:24,602 --> 00:02:31,224
齊次坐標的 W 值是線性內插，但是用在除法時造成這樣不一的變化

41
00:02:31,249 --> 00:02:33,162
回到設定遠近裁切面

42
00:02:33,187 --> 00:02:37,965
假設我們將近裁切面移動到五單位而沒有造成裁切

43
00:02:37,990 --> 00:02:42,590
我們等於是將原來的曲線往下拉

44
00:02:42,615 --> 00:02:46,468
首先我們得到遠近裁切面間範圍較小的好處

45
00:02:46,493 --> 00:02:48,599
而曲線也更線性

46
00:02:48,624 --> 00:02:54,545
當你將近裁切面往遠裁切面推，NDC Z 深度會越慢到 1

47
00:02:54,570 --> 00:02:58,642
簡而言之將近裁切面遠離攝影機有諸多好處

48
00:02:58,667 --> 00:03:01,950
比將遠裁切面向內移動相同距離好

49
00:03:01,975 --> 00:03:05,585
當然這又回到原來的問題：我們要怎麼設定這些裁切面

50
00:03:05,609 --> 00:03:08,693
遠裁切面通常相對簡單

51
00:03:08,718 --> 00:03:14,517
可能事前知曉，或是粗略算出場景中最遠的物件的距離

52
00:03:14,542 --> 00:03:16,427
近裁切面就比較難

53
00:03:16,452 --> 00:03:20,571
通常有些移動規則像是攝影機不能太接近牆

54
00:03:20,596 --> 00:03:26,226
或者近裁切面是遠裁切面距離的 1 / 1000 的粗略值

55
00:03:26,251 --> 00:03:30,712
有些複雜的系統會做預處理，將近裁切面設定離攝影機很近

56
00:03:30,737 --> 00:03:34,982
然後快速繪製近的物件推算出對場景適當的值

57
00:03:35,006 --> 00:03:36,355
再來才繪製整個場景

58
00:03:36,380 --> 00:03:38,340
沒有單一完美解法

